# Техническое задание: Сервис управления фича-флагами

## Общие требования к дизайну

- **Стиль**: Минималистичный, производительный, лаконичный, информативный UI
- **Целевая аудитория**: Понятный интерфейс даже для нетехнических пользователей
- **Технологии**: HTMX, Hyperscript, Bootstrap
- **Верстка**: Адаптивная и отзывчивая для всех устройств
- **Структура**: Четкая иерархия компонентов
- **Цель первого этапа**: Понятный и функциональный интерфейс (приоритет функциональности над эстетикой)

## Структура страниц

### 1. Экран флагов (основной экран)
**Путь**: `/flags`

**Компоненты**:
- **Хедер**:
  - Заголовок "Фича-флаги"
  - Переключатель окружения (dev, staging, prod)
  - Кнопка "Создать флаг"
  - Кнопка "Создать категорию"

- **Основная часть**:
  - **Поисковая панель**:
    - Поле поиска по названиям флагов и категорий
    - Фильтры (по статусу, категории, TTL)
    - Сортировка (по имени, дате создания, статусу)
  - **Список категорий и флагов**:
    - Структура аккордеона для категорий
    - Табличное представление флагов с колонками:
      - Имя флага
      - Ключ флага
      - Статус (активен/неактивен)
      - TTL (время жизни)
      - Кнопки быстрых действий (вкл/выкл, редактировать)
  - **Пагинация**:
    - Кнопки переключения страниц
    - Выбор количества элементов на странице

### 2. Экран деталей флага
**Путь**: `/flags/:id`

**Компоненты**:
- **Хедер**:
  - Название флага
  - Кнопка "Назад"
  - Кнопка "Редактировать"
  - Кнопка быстрого включения/выключения

- **Основная часть**:
  - **Информация о флаге**:
    - Имя
    - Ключ
    - Описание
    - Категория
    - Статус
    - TTL
    - Дата создания/модификации
  - **Настройки таргетинга** (если применимо):
    - Процент пользователей
    - Критерии таргетинга
  - **История изменений**:
    - Таблица с информацией о том, кто, когда и какие изменения внес

### 3. Экран создания/редактирования флага
**Путь**: `/flags/create` или `/flags/:id/edit`

**Компоненты**:
- **Хедер**:
  - Заголовок "Создание флага" или "Редактирование флага"
  - Кнопка "Отмена"
  - Кнопка "Сохранить"

- **Основная часть**:
  - **Форма**:
    - Поле имени флага
    - Поле ключа флага (автогенерация из имени)
    - Поле описания
    - Выбор категории (с возможностью создания новой)
    - Переключатель статуса
    - Настройка TTL (если применимо)
    - Настройки таргетинга (если применимо)

### 4. Экран первого пользователя (первичная настройка)
**Путь**: `/setup`

**Компоненты**:
- **Основная часть**:
  - **Логотип** и приветственный текст
  - **Форма регистрации первого пользователя**:
    - Поле Email
    - Поле Username
    - Поле Password
    - Поле подтверждения пароля
  - **Кнопка "Создать аккаунт"**
  - Информация о том, что это первичная настройка системы

### 5. Экран авторизации
**Путь**: `/login`

**Компоненты**:
- **Основная часть**:
  - **Логотип**
  - **Форма входа**:
    - Поле Email
    - Поле Password
    - Чекбокс "Запомнить меня"
  - **Кнопка "Войти"**

### 6. Экран настроек
**Путь**: `/settings`

**Компоненты**:
- **Хедер**:
  - Заголовок "Настройки"

- **Сайдбар настроек**:
  - **Access**:
    - Members
    - Groups
    - Roles
  - **General**:
    - Profile
    - Organization
    - Environments

- **Основная часть**:
  - Содержимое зависит от выбранного раздела в сайдбаре

### 7. Экран управления пользователями
**Путь**: `/settings/members`

**Компоненты**:
- **Хедер**:
  - Заголовок "Пользователи"
  - Кнопка "Добавить пользователя"

- **Основная часть**:
  - **Поисковая панель**:
    - Поле поиска пользователей
    - Фильтры по ролям
  - **Таблица пользователей**:
    - Username
    - Email
    - Роль
    - Статус
    - Дата регистрации
    - Кнопки действий (редактировать, деактивировать)
  - **Пагинация**

### 8. Экран аудита логов
**Путь**: `/audit`

**Компоненты**:
- **Хедер**:
  - Заголовок "Аудит логов"
  - Кнопка "Экспорт в CSV"

- **Основная часть**:
  - **Фильтры**:
    - Временной диапазон
    - Тип события
    - Пользователь
    - Объект (флаг/категория)
  - **Таблица логов**:
    - Дата/время
    - Пользователь
    - Действие
    - Объект
    - Детали
  - **Пагинация**

### 9. Страница ошибки 404
**Путь**: `*` (любой несуществующий путь)

**Компоненты**:
- **Основная часть**:
  - Сообщение об ошибке
  - Кнопка "Вернуться на главную"

### 10. Страница ошибки сервера
**Путь**: Отображается автоматически при ошибках 5xx

**Компоненты**:
- **Основная часть**:
  - Сообщение об ошибке
  - Идентификатор ошибки для обращения в поддержку
  - Кнопка "Обновить страницу"
  - Кнопка "Вернуться на главную"

## Общие компоненты

### 1. Сайдбар (основной)
**Компоненты**:
- **Логотип** (вверху)
- **Основная навигация**:
  - Флаги
  - Аудит логов
- **Нижняя секция**:
  - Иконка пользователя (переход в профиль)
  - Иконка настроек
  - Кнопка "Помощь"

**Мобильная версия (до 768px)**:
- Слайдер снизу экрана
- Компактное отображение пунктов меню
- Кнопка закрытия

### 2. Сайдбар настроек
**Компоненты**:
- **Access**:
  - Members
  - Groups
  - Roles
- **General**:
  - Profile
  - Organization
  - Environments

**Мобильная версия (до 768px)**:
- Слайдер снизу экрана или выпадающее меню

### 3. Header
**Компоненты**:
- Заголовок страницы
- Контекстные кнопки действий
- Переключатель окружения (где применимо)

### 4. Footer
**Компоненты**:
- Информация об авторском праве
- Версия сборки

### 5. Система уведомлений
**Компоненты**:
- Всплывающие уведомления об успешных/неуспешных действиях
- Индикаторы загрузки при выполнении операций

## Дополнительные рекомендации

1. **Интерактивный тур для новых пользователей**:
   - Краткое обучение основным функциям при первом входе

2. **Предпросмотр изменений**:
   - Возможность предварительного просмотра эффекта при включении/выключении флага

3. **Режим "только для чтения"**:
   - Для пользователей без прав редактирования

4. **Документация**:
   - Встроенная краткая справка по основным функциям

5. **Экран дашборда**:
   - Общая статистика и метрики по использованию флагов
   - Количество активных/неактивных флагов
   - Скоро истекающие флаги (по TTL)

6. **Система поиска**:
   - Полнотекстовый поиск по всем флагам и категориям
   - История поисковых запросов

7. **Интеграция с другими системами**:
   - Настройка webhooks для уведомлений о изменении статуса флагов
   - API-ключи для внешних систем

## Требования к иерархии компонентов

```
├── layouts
│   ├── auth.hbs      # Лейаут для авторизации и первичной настройки
│   └── main.hbs      # Основной лейаут с сайдбаром
│
├── components
│   ├── sidebar.hbs          # Основной сайдбар
│   ├── settingsSidebar.hbs  # Сайдбар настроек
│   ├── header.hbs           # Шапка страницы
│   ├── footer.hbs           # Подвал сайта
│   ├── notifications.hbs    # Система уведомлений
│   ├── pagination.hbs       # Компонент пагинации
│   ├── search.hbs           # Поисковая панель
│   ├── filterPanel.hbs      # Панель фильтрации
│   ├── flagList.hbs         # Список флагов
│   ├── categoryTree.hbs     # Дерево категорий
│   ├── flagForm.hbs         # Форма создания/редактирования флага
│   ├── flagToggle.hbs       # Переключатель статуса флага
│   ├── userForm.hbs         # Форма пользователя
│   └── auditTable.hbs       # Таблица логов аудита
│
└── pages
    ├── auth
    │   ├── login.hbs        # Страница входа
    │   └── setup.hbs        # Страница первичной настройки
    │
    ├── flags
    │   ├── index.hbs        # Список флагов
    │   ├── detail.hbs       # Детали флага
    │   └── form.hbs         # Форма флага
    │
    ├── settings
    │   ├── index.hbs        # Основная страница настроек
    │   ├── members.hbs      # Управление пользователями
    │   ├── groups.hbs       # Управление группами
    │   ├── roles.hbs        # Управление ролями
    │   ├── profile.hbs      # Профиль пользователя
    │   └── environments.hbs # Настройка окружений
    │
    ├── audit
    │   └── index.hbs        # Страница аудита
    │
    └── errors
        ├── 404.hbs          # Страница 404
        └── 500.hbs          # Страница ошибки сервера
```